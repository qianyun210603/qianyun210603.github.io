---
title: CTP踩坑记
date: 2024-01-21T18:38:25+08:00
toc: true
tags: 
categories: 
- Programming
- CTP
---

## 数据篇

- 郑商所数据垃圾值
  - 部分日夜盘最后一个tick的时间戳会被标到第二日；
  - 夜盘开始时20:5x会有垃圾tick；
  - 没有`最后修改毫秒`，需要自己插值；

- K线合成
- 注意每个交易时间段最后一个tick。比如合成5分钟K线，对9:00-10:15时间段，10:15整可能会有一个tick需要归到10:10开始的K线里。
- 一般的行情软件和数据商，包括TB、天软、米筐K线按第一个有成交的tick来计算，但CTP推送的时候按500ms切片，即便无成交。
- 可能有些高/低价包含在500ms内，从而不能从`last_price`得知。目前能做到的最好是参考CTP推送的日内最高/低价修正部分。

## 接口篇
- 似乎有两个乘数【合约数量乘数】和【合约基础商品乘数】，分别定义为
  ```cpp
    ///合约数量乘数
    TThostFtdcVolumeMultipleType VolumeMultiple;
    ///合约基础商品乘数
    TThostFtdcUnderlyingMultipleType UnderlyingMultiple;
  ```
   按文档，标的期货保证金为 [标的期货合约结算价×期货合约乘数×标的期货合约交易所保证金率（按金额）+ 标的期货合约交易所保证金
率(按手数) ]×基础商品乘数
   这个【合约基础商品乘数】到底怎么用的？
